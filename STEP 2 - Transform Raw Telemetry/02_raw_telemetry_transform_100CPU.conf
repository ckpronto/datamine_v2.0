# PostgreSQL Configuration for 100-CPU VM with 288GB RAM
# Add these lines to /etc/postgresql/16/main/postgresql.conf
# Or create a separate conf file in /etc/postgresql/16/main/conf.d/

# ============================================================================
# PARALLEL PROCESSING SETTINGS (100 CPU Optimization)
# ============================================================================
max_worker_processes = 100                    # Total worker processes
max_parallel_workers = 80                     # Parallel workers for queries
max_parallel_workers_per_gather = 16          # Workers per gather node
max_parallel_maintenance_workers = 16         # Workers for maintenance ops

# ============================================================================
# MEMORY SETTINGS (288GB RAM Optimization) 
# ============================================================================
shared_buffers = 72GB                         # 25% of RAM
effective_cache_size = 216GB                  # 75% of RAM  
work_mem = 2GB                                # Per-operation memory
maintenance_work_mem = 16GB                   # For bulk operations

# ============================================================================
# BULK OPERATION OPTIMIZATIONS
# ============================================================================
checkpoint_completion_target = 0.9
wal_buffers = 64MB
min_wal_size = 2GB
max_wal_size = 16GB
synchronous_commit = off
commit_delay = 10000
commit_siblings = 10

# ============================================================================
# I/O AND STORAGE OPTIMIZATIONS
# ============================================================================
random_page_cost = 1.1                        # SSD optimization
seq_page_cost = 1.0
effective_io_concurrency = 100                # Concurrent I/O operations
maintenance_io_concurrency = 50